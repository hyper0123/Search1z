# .github/workflows/manual-download.yml
name: Auto M3U Downloader

on:
  workflow_dispatch:
    inputs:
      country:
        description: 'Prefijo de paÃ­s (ej. AR, PE)'
        required: true
        default: 'AR'

permissions:
  contents: write

jobs:
  zoomeye:
    name: ðŸ”Ž ZoomEye Scan & Download
    runs-on: ubuntu-latest
    env:
      ZOOMEYE_API_KEY:  ${{ secrets.ZOOMEYE_API_KEY }}
      ZOOMEYE_USERNAME: ${{ secrets.ZOOMEYE_USERNAME }}
      ZOOMEYE_PASSWORD: ${{ secrets.ZOOMEYE_PASSWORD }}
    steps:
      - uses: actions/checkout@v3
        with:
          persist-credentials: true
          fetch-depth: 0

      - uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - run: pip install requests

      - name: Run ZoomEye
        run: python3 m3u_downloader.py --country ${{ github.event.inputs.country }} --source zoomeye

      - name: Commit ZoomEye results
        run: |
          git add playlists/zoomeye/
          git diff --quiet || git commit -m "ZoomEye playlists ${{ github.event.inputs.country }}"
          git push

  fofa:
    name: ðŸ”Ž FOFA Scan & Download
    needs: zoomeye
    runs-on: ubuntu-latest
    env:
      FOFA_EMAIL: ${{ secrets.FOFA_EMAIL }}
      FOFA_KEY:   ${{ secrets.FOFA_KEY }}
    steps:
      - uses: actions/checkout@v3
        with:
          persist-credentials: true
          fetch-depth: 0

      - uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - run: pip install requests

      - name: Run FOFA
        run: python3 m3u_downloader.py --country ${{ github.event.inputs.country }} --source fofa

      - name: Commit FOFA results
        run: |
          git add playlists/fofa/
          git diff --quiet || git commit -m "FOFA playlists ${{ github.event.inputs.country }}"
          git push
